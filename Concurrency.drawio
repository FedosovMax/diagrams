<mxfile host="app.diagrams.net" modified="2021-02-21T10:12:41.760Z" agent="5.0 (Windows)" etag="cpJFzu1JaL8ng7AOHpdU" version="14.1.8" type="github">
  <diagram id="dARw1I-tyCDDxnHPdXPz" name="Page-1">
    <mxGraphModel dx="1185" dy="659" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="QMmgmNxQZZJa730i63d_-40" value="" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#FF8000;align=left;" vertex="1" parent="1">
          <mxGeometry x="40" y="1100" width="370" height="181" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-33" value="" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#FF8000;align=left;" vertex="1" parent="1">
          <mxGeometry x="30" y="120" width="660" height="70" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-26" value="" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#FF8000;align=left;" vertex="1" parent="1">
          <mxGeometry x="30" y="510" width="660" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-16" value="" style="rounded=0;whiteSpace=wrap;html=1;align=left;fillColor=#ffe6cc;strokeColor=#FF8000;" vertex="1" parent="1">
          <mxGeometry x="30" y="280" width="660" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-12" value="" style="rounded=0;whiteSpace=wrap;html=1;align=left;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="30" y="400" width="660" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-1" value="&lt;font style=&quot;font-size: 18px&quot;&gt;4. Компоновка объектов&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="20" y="30" width="220" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-3" value="&lt;div align=&quot;left&quot;&gt;&lt;b&gt;Проектирование потокобезопасного класса:&lt;/b&gt; &lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;1. идентификация переменных, формирующих состояние объекта.&lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font color=&quot;#FF8000&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;2. идентификация инвариантов, ограничивающих переменные состояния и постусловий.&amp;nbsp;&lt;/font&gt; &lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;3. создание политики для управления конкурентным доступом к состоянию объекта.&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="124" width="520" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-4" value="Политики синхронизации (synchronization policy). (рекомендуется документировать. @GuardedBy(&quot;this&quot;)" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="200" width="600" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-5" value="&lt;div&gt;Примитивные переменные содержат все состояние объекта, &lt;br&gt;&lt;/div&gt;&lt;div&gt;ссылочные включают в себя другие объекты влияющие на потокобезопасность&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="230" width="470" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-6" value="&lt;div&gt;final уменьшает пространство состояний переменных. (state space) &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Инварианты&lt;/b&gt;: различают valid и invalid состояния. (Long.MIN_VALUE - Long.MAX_VALUE valid)&lt;/div&gt;&lt;div&gt;&lt;b&gt;Постусловия&lt;/b&gt;: 17 -&amp;gt; 18 -&amp;gt; 19 -&amp;gt; 20 (допустимые переходы состояний)&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="320" width="540" height="50" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-7" value="&lt;div align=&quot;left&quot;&gt;&lt;b&gt;Обеспечивайте потокобезопасность, учитывая роль инвариантов и постусловий.&lt;/b&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="370" width="490" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-8" value="" style="rounded=0;whiteSpace=wrap;html=1;align=left;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="30" y="75" width="660" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-10" value="&lt;font style=&quot;font-size: 14px&quot;&gt;4.1. Проектирование потокобезопасного класса&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="80" width="330" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-11" value="&lt;font style=&quot;font-size: 14px&quot;&gt;4.1.1. Сбор требований к синхронизации&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="285" width="290" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-15" value="&lt;font style=&quot;font-size: 14px&quot;&gt;4.1.2. Операции зависимые от состояния&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="405" width="290" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-17" value="&lt;div align=&quot;left&quot;&gt;Методы с предусловиями основанными на состоянии. (&lt;b&gt;state-dependent&lt;/b&gt; методы. Проверяющие что очередь &lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;пустая а значит с нее нельзя удалять объекты) &lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="445" width="630" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-18" value="Если предусловие не соблюдается: " style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="200" y="480" width="220" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-19" value="&lt;b&gt;&lt;font color=&quot;#00CC00&quot;&gt;One thread: &lt;/font&gt;&lt;/b&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="510" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-20" value="&lt;b&gt;&lt;font color=&quot;#007FFF&quot;&gt;Multithreading: &lt;/font&gt;&lt;/b&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="340" y="510" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-21" value="Операция завершается безрезультатно." style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="530" width="250" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-22" value="&lt;div&gt;Ожидает появления потока принимающий имеющееся &lt;br&gt;&lt;/div&gt;&lt;div&gt;условие для продолжения работы.&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="340" y="532" width="330" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-23" value="&lt;div align=&quot;left&quot;&gt;&lt;b&gt;wait()&lt;/b&gt; и &lt;b&gt;notify()&lt;/b&gt; сложны в применении по этому вместо них используются библиотечные классы, такие как &lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;b&gt;блокирующие очереди&lt;/b&gt; или &lt;b&gt;семафоры&lt;/b&gt;. &lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;Блокирующие библиотечные классы (&lt;b&gt;BlockingQueue&lt;/b&gt;, &lt;b&gt;Semaphore &lt;/b&gt;и другие синхронизаторы) &lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="580" width="620" height="50" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-24" value="" style="rounded=0;whiteSpace=wrap;html=1;align=left;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="30" y="650" width="660" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-25" value="&lt;font style=&quot;font-size: 14px&quot;&gt;4.1.3. Владение состоянием&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="655" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-27" value="" style="endArrow=none;html=1;fillColor=#ffe6cc;strokeColor=#FF8000;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="309.66" y="570" as="sourcePoint" />
            <mxPoint x="310" y="510" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-28" value="&lt;div align=&quot;left&quot;&gt;&lt;b&gt;Объект владеет состоянием которое инкапсулирует&lt;/b&gt; и отвечает за управление многопоточным доступом.&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="700" width="620" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-29" value="&lt;div&gt;&lt;b&gt;Объект не владеет состоянием объектов передаваемых в методы&lt;/b&gt; если только он не предназначен для&lt;/div&gt;&lt;div&gt;передачи права владения.&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="730" width="620" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-30" value="&lt;div&gt;&lt;b&gt;Коллекционные классы часто демонстрируют форму раздельного владения&lt;/b&gt;: они владеют состоянием &lt;br&gt;&lt;/div&gt;&lt;div&gt;коллекции, но хранящиеся у себя объекты передают клиентскому коду&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="770" width="620" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-31" value="" style="rounded=0;whiteSpace=wrap;html=1;align=left;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="30" y="820" width="660" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-32" value="&lt;font style=&quot;font-size: 14px&quot;&gt;4.2. Ограничение одним экземпляром&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="825" width="270" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-34" value="&lt;div&gt;&lt;b&gt;Непотокобезопасный &lt;/b&gt;объект можно использовать безопасно с о&lt;b&gt;граничением одним потоком&lt;/b&gt; или &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;блокировкой&lt;/b&gt;. &lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="860" width="580" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-36" value="&lt;div&gt;&lt;b&gt;Инкапсуляция &lt;/b&gt;упрощает создание потокобезопасных классов, обеспечивая &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;ограничение одним экземпляром&lt;/b&gt; (instance confinement), которое часто называется &lt;b&gt;запиранием &lt;/b&gt;(confinement).&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;i&gt;Объект инкапсулируется в другой объект, к которому имеют доступ только некоторые &lt;br&gt;&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;i&gt;известные ветви кода, а не вся программа&lt;/i&gt;&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="900" width="650" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-37" value="&lt;div&gt;&lt;b&gt;Инкапсуляция данных в объекте ограничивает доступ к ним только методами объекта, что упрощает &lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;обеспечение постоянного доступа с удержанием замка.&lt;/b&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="970" width="610" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-38" value="&lt;div align=&quot;left&quot;&gt;Ограниченные экземпляром объекты не должны выходить за пределы своей области действия. &lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;Объект может быть ограничен &lt;b&gt;экземпляром класса &lt;/b&gt;(например, приватным членом класса), &lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;b&gt;лексической областью&lt;/b&gt; (например, локальной переменной) или &lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;b&gt;потоком &lt;/b&gt;(например, объектом, который передается из метода в метод внутри одного потока). &lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;b&gt;Публикуйте объекты осторожно.&lt;/b&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="1010" width="570" height="80" as="geometry" />
        </mxCell>
        <mxCell id="QMmgmNxQZZJa730i63d_-39" value="&lt;div align=&quot;left&quot;&gt;@ThreadSafe&lt;br&gt;public class PersonSet {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; @GuardedBy(&quot;this&quot;)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; private final Set&amp;lt;Person&amp;gt; mySet = new HashSet&amp;lt;Person&amp;gt;();&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; public synchronized void addPerson(Person p) {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; mySet.add(p);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; public synchronized boolean containsPerson(Person p) {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return mySet.contains(p);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;}&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="1110" width="360" height="160" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
